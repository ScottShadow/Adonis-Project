<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
</head>

<body class="bg-[var(--background-color)] text-[var(--text-color)] min-h-screen flex flex-col md:flex-row">
    <div class="flex-1 p-6 space-y-6">
        {% include 'theme-switcher.html' %}
        {% include 'navbar.html' %}



        <!-- Friend Requests Section -->
        <section class="table-container" id="friend-requests" class="visible">
            <h2 class="text-lg font-semibold">Friend Requests</h2>
            {% if friend_requests %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Requester</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in friend_requests %}
                    <tr class="border-b border-[var(--accent-color)]">
                        <td class="py-3 px-4">{{ request.username }}</td>
                        <td class="table-actions">
                            <form class="ajax-action-form" method="POST"
                                action="{{ url_for('chat_views.accept_friend_request', user_id=request.id) }}">
                                <button type="submit" class="accept-button">Accept</button>
                            </form>
                            <form class="ajax-action-form" method="POST"
                                action="{{ url_for('chat_views.reject_friend_request', user_id=request.id) }}">
                                <button type="submit" class="reject-button">Reject</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>You have no pending friend requests.</p>
            {% endif %}
        </section>
        <!-- Friend Requests Sent Section -->
        <section class="table-container" id="requests-sent" class="hidden">
            <h2 class="text-lg font-semibold">Requests Sent</h2>
            {% if sent_requests %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Recipient</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for request in sent_requests %}
                    <tr class="border-b border-[var(--accent-color)]">
                        <td class="py-3 px-4">{{ request.username }}</td>
                        <td class="table-actions">
                            <form class="ajax-action-form" method="POST"
                                action="{{ url_for('chat_views.cancel_friend_request', user_id=request.id) }}">
                                <button type="submit" class="reject-button">Cancel Request</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>You haven't sent any friend requests yet.</p>
            {% endif %}
            <p></p>
            <form method="GET" action="{{ url_for('chat_views.people') }}">
                <input type="hidden" name="action" value="People">
                <button type="submit" class="accept-button">Find more people</button>
            </form>
        </section>

        <!-- Friend List Section -->
        <section class="table-container" id="friend-list" class="hidden">
            <h2 class="text-lg font-semibold">Your Friends</h2>
            {% if friends %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for friend in friends %}
                    <tr class="border-b border-[var(--accent-color)]">
                        <td class="py-3 px-4">{{ friend.username }}</td>
                        <td class="table-actions">
                            <form method="POST" action="{{ url_for('chat_views.start_dm', user_id=friend.id) }}">
                                <button type="submit" class="dm-button">DM</button>
                            </form>
                            <form class="ajax-action-form" method="POST"
                                action="{{ url_for('chat_views.unfriend', user_id=friend.id) }}">
                                <button type="submit" class="reject-button">Remove</button>
                            </form>
                            <form class="ajax-action-form" method="POST"
                                action="{{ url_for('chat_views.block_user', user_id=friend.id) }}">
                                <button type="submit" class="block-button">Block</button>
                            </form>

                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>You don't have any friends yet. Send some friend requests!</p>
            {% endif %}
        </section>

        <!-- Friends' Logs Section -->
        <section class="table-container" id="friend-logs" class="visible">
            <h2 class="text-lg font-semibold">Friends' Logs</h2>
            {% if friends %}
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Level</th>
                        <th>Last Public Log</th>
                        <th>Log Details</th>
                        <th>Logged At</th>
                    </tr>
                </thead>
                <tbody>
                    {% for friend in friends_logs %}
                    <tr class="border-b border-[var(--accent-color)]">
                        <td class="py-3 px-4">{{ friend.name }}</td>
                        <td class="py-3 px-4">{{ friend.level }}</td>
                        <td class="py-3 px-4">{{ friend.habit_name }}</td>
                        <td class="py-3 px-4">{{ friend.log_details }}</td>
                        <td class="py-3 px-4">{{ friend.last_log_date }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No public logs from friends yet.</p>
            {% endif %}
        </section>

        <a href="{{ url_for('app_views.dashboard_route') }}"
            class="bg-[var(--background-color)] mt-4 text-sm underline">Back to Dashboard</a>
    </div>
    <script src="{{ url_for('static', filename='scripts/friend_page.js') }}"></script>
    <!-- JavaScript -->

</body>

</html>